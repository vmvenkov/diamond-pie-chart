<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pie Chart</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #142940;
      font-family: 'Segoe UI', sans-serif;
      color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
    }

    .pie-container {
      width: 100%;
      max-width: 600px;
      padding: 20px;
      box-sizing: border-box;
    }

    h2 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.2em;
    }

    #datasetSelector {
      display: block;
      margin: 0 auto 20px auto;
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #555;
      background-color: #1f3a4d;
      color: #f0f0f0;
      font-size: 1em;
    }

    #pieChart {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="pie-container">
    <h2 id="chartTitle">Top 5 countries in Production (CTS)</h2>
    <select id="datasetSelector">
      <option value="Prod_CTS">Production (CTS)</option>
      <option value="Prod_USD">Production (USD)</option>
      <option value="Imp_CTS">Import (CTS)</option>
      <option value="Imp_USD">Import (USD)</option>
      <option value="Exp_CTS">Export (CTS)</option>
      <option value="Exp_USD">Export (USD)</option>
    </select>
    <div id="pieChart"></div>
  </div>

  <script>
    const palette = ['#4cc9f0', '#4361ee', '#3a0ca3', '#7209b7', '#f72585', '#4895ef'];

    const dataSets = {
      Prod_CTS: {
        labels: ['Russia', 'Botswana', 'Angola', 'Canada', 'Congo, Dem Rep of the', 'Others'],
        values: [37322793.87, 28181710, 14027002.73, 13321628, 9788201.86, 15318372.20]
      },
      Prod_USD: {
        labels: ['Russia', 'Botswana', 'Angola', 'Canada', 'Namibia', 'Others'],
        values: [3335490164.66, 3308086421.89, 1412182462.11, 1075005840.22, 966944622.83, 1384373398.36]
      },
      Imp_CTS: {
        labels: ['India', 'United Arab Emirates', 'China', 'Armenia', 'Botswana', 'Others'],
        values: [114112209.78, 83073718.55, 19180609.78, 9378103.99, 6343978.75, 55332454.2]
      },
      Imp_USD: {
        labels: ['India', 'United Arab Emirates', 'Armenia', 'China', 'Botswana', 'Others'],
        values: [12177896440.5, 7282739584.66, 2073007937.09, 1466904400.04, 964645910.45, 6824689874.49]
      },
      Exp_CTS: {
        labels: ['United Arab Emirates', 'Russia', 'India', 'Botswana', 'China', 'Others'],
        values: [85682342.59, 30371359.82, 22789356.81, 20342706.06, 17380053.61, 108336222]
      },
      Exp_USD: {
        labels: ['United Arab Emirates', 'Botswana', 'Russia', 'South Africa', 'China', 'Others'],
        values: [9832001244.83, 2813405410.59, 2622759701.28, 1578054484.59, 1567376745.88, 11595309911.99]
      }
    };

    function renderPieChart(datasetKey) {
      const raw = dataSets[datasetKey];
      const zipped = raw.labels.map((label, i) => ({ label, value: raw.values[i] }));
      zipped.sort((a, b) => b.value - a.value);

      const top5 = zipped.slice(0, 5);
      const othersSum = zipped.slice(5).reduce((sum, d) => sum + d.value, 0);
      if (othersSum > 0) top5.push({ label: 'Others', value: othersSum });

      const labels = top5.map(d => d.label);
      const values = top5.map(d => d.value);

      const data = [{
        type: 'pie',
        labels: labels,
        values: values,
        textinfo: 'label+percent',
        insidetextorientation: 'radial',
        marker: {
          colors: palette.slice(0, labels.length),
          line: { color: '#142940', width: 2 }
        }
      }];

      const layout = {
        paper_bgcolor: '#142940',
        plot_bgcolor: '#142940',
        font: { color: '#f0f0f0' },
        margin: { t: 20, b: 20, l: 10, r: 10 },
        height: 300
      };

      document.getElementById('chartTitle').textContent = 'Top 5 countries in ' + datasetKey.replace('_', ' ');

      Plotly.newPlot('pieChart', data, layout, { responsive: true });
    }

    document.getElementById('datasetSelector').addEventListener('change', (e) => {
      renderPieChart(e.target.value);
    });

    // Initial render
    renderPieChart('Prod_CTS');
  </script>
</body>
</html>
